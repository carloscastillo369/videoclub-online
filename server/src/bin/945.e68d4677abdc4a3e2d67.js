"use strict";(self.webpackChunkapp_videoclub=self.webpackChunkapp_videoclub||[]).push([[945],{945:(J,m,i)=>{i.r(m),i.d(m,{CheckoutModule:()=>Y});var u=i(8583),d=i(6983),x=i(5319),h=i(8109),p=i(3781),C=i(7545),f=i(4706),g=i(1175),Z=i(1146),t=i(7716),P=i(3065),b=i(3062),T=i(7001),v=i(5618),M=i(6627),A=i(1769),y=i(5244),U=i(1095);function O(e,c){if(1&e){const o=t.EpF();t.TgZ(0,"div",1),t.TgZ(1,"div",2),t.TgZ(2,"mat-icon"),t._uU(3,"shopping_cart_checkout"),t.qZA(),t.TgZ(4,"span"),t._uU(5,"Resumen de mi orden"),t.qZA(),t.qZA(),t.TgZ(6,"div",3),t.TgZ(7,"div",4),t.TgZ(8,"div",5),t.TgZ(9,"h3",6),t._uU(10,"Datos Personales:"),t.qZA(),t._UZ(11,"mat-divider"),t.TgZ(12,"p",7),t._uU(13,"Nombre: "),t.TgZ(14,"span",8),t._uU(15),t.qZA(),t.qZA(),t.TgZ(16,"p",7),t._uU(17,"Email: "),t.TgZ(18,"span",8),t._uU(19),t.qZA(),t.qZA(),t.TgZ(20,"p",7),t._uU(21,"Direcci\xf3n: "),t.TgZ(22,"span",8),t._uU(23),t.qZA(),t.qZA(),t.TgZ(24,"p",7),t._uU(25,"Tel\xe9fono: "),t.TgZ(26,"span",8),t._uU(27),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(28,"div",9),t.TgZ(29,"div",10),t.TgZ(30,"h3",6),t._uU(31,"Lista de pedido"),t.qZA(),t._UZ(32,"mat-divider"),t._UZ(33,"app-orders-table",11),t.TgZ(34,"div",12),t.TgZ(35,"h3",6),t._uU(36),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.qZA(),t.TgZ(37,"div",13),t.TgZ(38,"button",14),t.TgZ(39,"mat-icon"),t._uU(40,"shopping_cart"),t.qZA(),t._uU(41," Seguir Comprando "),t.qZA(),t.TgZ(42,"button",15),t.NdJ("click",function(){const r=t.CHM(o).ngIf,s=t.oxw();return s.payment(r,s.orders)}),t.TgZ(43,"mat-icon"),t._uU(44,"credit_card"),t.qZA(),t._uU(45," Pagar "),t.qZA(),t.qZA(),t.qZA()}if(2&e){const o=c.ngIf,n=t.oxw();t.xp6(15),t.Oqu(o.name),t.xp6(4),t.Oqu(o.email),t.xp6(4),t.Oqu(o.address),t.xp6(4),t.Oqu(o.phone),t.xp6(6),t.Q6J("orders",n.orders),t.xp6(3),t.hij("Total a Pagar: $ ",n.totalPriceCart.toFixed(2),"")}}const k=[{path:"",component:(()=>{class e{constructor(o,n,a,r){this.store=o,this._apiMoviesService=n,this.snackBar=a,this.router=r,this.orders=[],this.totalPriceCart=0,this.duration=3,this.verticalPosition="top",this.horizontalPosition="center",this.subscription=new x.w}ngOnInit(){this.getUser(),this.getItemsCart(),this.getTotalPriceCart()}ngOnDestroy(){this.subscription.unsubscribe()}getUser(){this.user=this.store.select(C.P),this.store.dispatch((0,p.II)())}getItemsCart(){this.subscription.add(this.store.select(f.dv).subscribe(o=>{let n=[];o.map(a=>{n.push({id:a.id,title:a.title,price:a.price,days:a.days})}),this.orders=n})),this.store.dispatch((0,g.Eh)())}getTotalPriceCart(){this.store.select(f.Lv).subscribe(o=>{this.totalPriceCart=o})}payment(o,n){let a=[],r=[];n.forEach(s=>{this._apiMoviesService.getMovie(s.id).subscribe(j=>{j[0].stock>0?a.push(s):r.push(s)})}),this.snackBar.openFromComponent(h.E,{data:{title:"",message:"Procesando tu compra..."},duration:2e3*this.duration,verticalPosition:this.verticalPosition,horizontalPosition:this.horizontalPosition,panelClass:"processing"}),setTimeout(()=>{n.length==a.length?(this.store.dispatch((0,Z.fS)({user:o,order:n})),n.forEach(s=>{this.reduceStock(s.id)}),setTimeout(()=>{this.snackBar.openFromComponent(h.E,{data:{title:"",message:"Pedido realizado con \xe9xito!"},duration:1e3*this.duration,verticalPosition:this.verticalPosition,horizontalPosition:this.horizontalPosition,panelClass:"success"}),this.store.dispatch((0,g.al)()),this.router.navigate(["/public/movies"])},3e3)):(this.snackBar.openFromComponent(h.E,{data:{title:"Pedido no completado",message:r.length>1?"Las siguiente pel\xedculas ya no est\xe1n disponibles. Por favor, verifica tu carrito de compras":"La siguiente pel\xedcula ya no est\xe1 disponible. Por favor, verifica tu carrito de compras",orders:r},duration:3e3*this.duration,verticalPosition:this.verticalPosition,horizontalPosition:this.horizontalPosition,panelClass:"error"}),r.forEach(s=>{this.store.dispatch((0,g.jT)({id:s.id}))}),this.router.navigate(["/public/cart"]))},2e3)}reduceStock(o){this.subscription.add(this._apiMoviesService.getMovie(o).subscribe(n=>{this.upDateStock(n[0].stock-1,o)}))}upDateStock(o,n){this.subscription.add(this._apiMoviesService.updateMovie({stock:o},n).subscribe(a=>{}))}}return e.\u0275fac=function(o){return new(o||e)(t.Y36(P.yh),t.Y36(b.l),t.Y36(T.ux),t.Y36(d.F0))},e.\u0275cmp=t.Xpm({type:e,selectors:[["app-checkout-page"]],decls:2,vars:3,consts:[["class","checkout-container",4,"ngIf"],[1,"checkout-container"],["fxLayout","row wrap","fxLayoutAlign","start center",1,"cart-text"],["fxLayout","row wrap","fxLayoutAlign","space-between"],["fxFlex","100","fxFlex.gt-sm","30",1,"personal-data"],[1,"data"],[1,"text-bold"],[1,"text-title"],[1,"text-subtitle"],["xFlex","100","fxFlex.gt-sm","69",1,"orders-table-container"],[1,"orders-table"],[3,"orders"],[1,"total-price"],[1,"buttons-container"],["mat-raised-button","","color","accent","routerLink","/public/movies",1,"btn-movies"],["mat-raised-button","","color","warn",1,"btn-Pay",3,"click"]],template:function(o,n){1&o&&(t.YNc(0,O,46,6,"div",0),t.ALo(1,"async")),2&o&&t.Q6J("ngIf",t.lcZ(1,1,n.user))},directives:[u.O5,v.xw,v.Wh,M.Hw,v.yH,A.d,y.U,U.lW,d.rH],pipes:[u.Ov],styles:[".checkout-container[_ngcontent-%COMP%]{background-color:#181818;padding:20px 5px}.cart-text[_ngcontent-%COMP%]{width:100%;margin-bottom:10px;font-size:15px;font-style:italic;color:#fff}.personal-data[_ngcontent-%COMP%]{width:100%;background-color:#212121;border-radius:5px;padding:20px 5px;margin-bottom:10px}.data[_ngcontent-%COMP%]{background-color:#fff;color:#000;padding:10px}.orders-table-container[_ngcontent-%COMP%]{width:100%;background-color:#212121;border-radius:5px;padding:20px 5px;margin-bottom:10px}.orders-table[_ngcontent-%COMP%]{width:100%;padding:10px;background-color:#fff;color:#000}.text-title[_ngcontent-%COMP%]{font-weight:bold}.text-subtitle[_ngcontent-%COMP%]{font-weight:normal;font-style:italic}.text-bold[_ngcontent-%COMP%]{font-weight:bold;margin-bottom:0}.total-price[_ngcontent-%COMP%]{width:100%;text-align:right;box-sizing:border-box;padding-right:24px}.buttons-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap;justify-content:flex-end;padding:20px;box-sizing:border-box}.btn-Pay[_ngcontent-%COMP%]{width:180px;height:50px;margin-left:10px}.btn-movies[_ngcontent-%COMP%]{width:180px;height:50px;margin-bottom:10px}mat-divider[_ngcontent-%COMP%]{margin-bottom:20px}@media (min-width: 600px){.cart-text[_ngcontent-%COMP%]{font-size:20px}}"]}),e})()}];let F=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[d.Bz.forChild(k)],d.Bz]}),e})();var S=i(9673),z=i(4466),E=i(5566),l=i(5887),L=i(9773),I=i(8002),B=i(7556);let D=(()=>{class e{constructor(o,n){this.actions$=o,this._authService=n,this.loadUser$=(0,l.GW)(()=>this.actions$.pipe((0,l.l4)(p.II),(0,L.zg)(a=>this._authService.getDataUser().pipe((0,I.U)(r=>(0,p.oN)({user:r.dataUser}))))))}}return e.\u0275fac=function(o){return new(o||e)(t.LFG(l.eX),t.LFG(B.e))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac}),e})();var w=i(6927);let Y=(()=>{class e{}return e.\u0275fac=function(o){return new(o||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[[u.ez,F,S.q,z.m,E.o9,l.sQ.forFeature([D,w.F])]]}),e})()}}]);